# 📦 Lesta Backend (FastAPI)

## 📚 Содержание

1. [Стек технологий](#стек-технологий)
2. [Структура проекта](#структура-проекта)
3. [Версия приложения](#версия-приложения)
4. [Конфигурируемые параметры](#конфигурируемые-параметры)
5. [Диаграмма структуры БД](#диаграмма-структуры-бд)
6. [Запуск приложения и зависимости](#запуск-приложения)
7. [Changelog](#changelog)
8. [Сравнение с тестовой версией](#сравнение-с-тестовой-версией)
9. [Результаты ревью](#результаты-ревью)

---

## 🧰 Стек технологий

- **Язык**: Python 3.12
- **Фреймворк**: FastAPI
- **База данных**: PostgreSQL
- **ORM**: SQLAlchemy
- **Миграции**: Alembic
- **Контейнеризация**: Docker + Docker Compose
- **JWT авторизация**: `python-jose`, `passlib`
- **Документация API**: Swagger UI (`/docs`)
- **CORS**: Поддержка через FastAPI middleware

---

## 📁 Структура проекта

lesta\_tz\_backend/
├── src/
│   ├── api/                # Эндпоинты API
│   ├── db.py                # Инициализация и подключение к БД
│   ├── models.py         # SQLAlchemy модели
│   ├── schemas.py            # Pydantic схемы

│  ├── config.py            #конфигурация проект
│   └── main.py             # Точка входа FastAPI
├── alembic/                # Миграции Alembic
├── tests/                  # Юнит-тесты
├── Dockerfile
├── docker-compose.yml
├── .env.example
└── requirements.txt

---

## 🧩 Версия приложения

**v1.0.1**

---

## ⚙️ Конфигурируемые параметры

Файл `.env`:

| Переменная          | Назначение                                          |
| ----------------------------- | ------------------------------------------------------------- |
| `POSTGRES_USER`               | Пользователь PostgreSQL                           |
| `POSTGRES_PASSWORD`           | Пароль PostgreSQL                                       |
| `POSTGRES_DB`                 | Название БД                                         |
| `DB_HOST`                     | Хост БД (например,`db`)                         |
| `DB_PORT`                     | Порт PostgreSQL                                           |
| `DB_NAME`                     | Название БД                                         |
| `DB_USER`                     | Пользователь БД                                 |
| `DB_PASS`                     | Пароль БД                                             |
| `PGADMIN_DEFAULT_EMAIL`       | Email администратора pgAdmin                    |
| `PGADMIN_DEFAULT_PASSWORD`    | Пароль для pgAdmin                                   |
| `ALLOW_ORIGINS`               | Список разрешенных CORS-источников |
| `PGADMIN_PORT`                | Порт pgAdmin                                              |
| `PORTAINER_PORT`              | Порт Portainer                                            |
| `BACKEND_PORT`                | Порт backend-сервера                               |
| `BACKEND_VIRTUAL_HOST`        | Виртуальный хост для backend                |
| `PGADMIN_VIRTUAL_HOST`        | Виртуальный хост для pgAdmin                |
| `PORTAINER_VIRTUAL_HOST`      | Виртуальный хост для Portainer              |
| `LETSENCRYPT_EMAIL`           | Email для Let's Encrypt                                    |
| `SECRET_KEY`                  | Ключ подписи JWT                                   |
| `ALGORITHM`                   | Алгоритм JWT (`HS256`)                                |
| `REFRESH_TOKEN_EXPIRE_DAYS`   | Время жизни refresh-токена                    |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Время жизни access-токена                     |
| `APP_VERSION`                 | Версия приложения                             |

---

## 📊 Диаграмма структуры БД

```
┌────────────┐
│   Users    │
│────────────│
│ id (PK)    │
│ email      │
│ name       │
│ password   │
└────┬───────┘
│
┌────────────────┴──────────────┐
│                               │
▼                               ▼

┌──────────────┐              ┌────────────────┐
│  Documents   │              │  Collections   │
│──────────────│              │────────────────│
│ id (PK)      │              │ id (PK)        │
│ filename     │              │ name           │
│ file_path    │              │ owner_id (FK)  │
│ owner_id (FK)│              └────┬───────────┘
└────┬─────────┘                   │
│                             │
│                             ▼
│                    ┌─────────────────────┐
│                    │ CollectionDocuments │
│                    │─────────────────────│
│                    │ id (PK)             │
└────┐         ┌────▶│ collection_id (FK)  │
│         │     │ document_id (FK)    │
▼         ▼     └─────────────────────┘
┌────────────────────────────┐
│      DocumentWords         │
│────────────────────────────│
│ id (PK)                    │
│ document_id (FK)          │
│ word_id (FK)              │
│ text                      │
│ tf                        │
└───────────┬─────────────────────────────┘
│
▼
┌────────────┐
│   Words    │
│────────────│
│ id (PK)    │
│ text       │
└────────────┘

┌────────────────────┐
│     AppMetrics     │
│────────────────────│
│ id (PK)            │
│ files_processed    │
│ min/avg/max_time   │
│ last_user_id/name  │
│ last_file_*        │
└────────────────────┘
```

## 🚀 Запуск приложения

### Через Docker Compose

```bash
docker-compose up --build
```

Приложение будет доступно по адресу: [http://localhost:8000](http://localhost:8000)

Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)

## 📝 Changelog

### v1.0.0 (2025-06-9)

* 🛠 Реализация пользователей и связь их с документами
* 🔐 JWT авторизация
* 🧾 Swagger UI через `/docs`

### Review (@Darkvran)

+ Отличная организация кода и архитектура.
+ Полноценная реализованная Frontend часть.
+ Отлично реализованная авторизация в API через токен
+ Хорошая оптимизация
+ Код соответствует PEP8, имеет достаточное количество комментариев
+ Качественная обработка ошибок в коде

- Не получилось запустить приложение через контейнеры.
- Ощущение что процесс обертки приложения в контейнеры можно реализовать проще (использовать один docker-compose, вместо двух. Это упростило бы процесс отладки и запуска приложения)
- Плохо оформленный, разбросанный по всему проекту readme,  (Добавить структуру, добавить его в одно место, сделать его более подробным. Добавить чейнджлог, описание модулей проекта, более подробное описание процедуры запуска).

### Задачи на Будущее

поменять хранение метрик из БД в sqllite 

## Результаты ревью
### Плюсы:
- Отличная организация кода и архитектура.
- Полноценная реализованная Frontend часть.
- Отлично реализованная авторизация в API через токен
- Хорошая оптимизация
- Код соответствует PEP8, имеет достаточное количество комментариев
- Качественная обработка ошибок в коде
### Минусы:
- Не получилось запустить приложение через контейнеры.
- Ощущение что процесс обертки приложения в контейнеры можно реализовать проще (использовать один docker-compose, вместо двух. Это упростило бы процесс отладки и запуска приложения)
- Плохо оформленный, разбросанный по всему проекту readme,  (Добавить структуру, добавить его в одно место, сделать его более подробным. Добавить чейнджлог, описание модулей проекта, более подробное описание процедуры запуска).
- Не описаны в полной мере коды состояний в Swagger
